{%- comment -%}
  Icon snippet
  Usage: {% render 'icon', icon: 'lightning' %}

  Now uses dynamic lookup from assets/icons.json
{%- endcomment -%}

{%- assign icon_handle = icon | default: settings.icon -%}
{%- assign current_icon = icons[icon_handle] -%}
{%- assign class_attr = 'icon' -%}
{%- if class != blank -%}
  {%- assign class_attr = class_attr | append: ' ' | append: class -%}
{%- endif -%}
{%- capture svg_open -%}<svg class="{{ class_attr }}" {%- endcapture -%}

{%- if current_icon -%}
  {%- assign icon_svg = current_icon.body | replace: '<svg', svg_open -%}
  {{ icon_svg }}
{%- else -%}
  {%- assign fallback_icon = icons['help-circle'] -%}
  {%- if fallback_icon -%}
    {%- assign fallback_svg = fallback_icon.body | replace: '<svg', svg_open -%}
    {{ fallback_svg }}
  {%- else -%}
    {%- comment -%} Ultimate fallback: simple circle with question mark {%- endcomment -%}
    <svg class="{{ class_attr }}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/>
    </svg>
  {%- endif -%}
{%- endif -%}
