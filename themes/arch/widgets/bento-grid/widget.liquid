<section
  id="{{ widget.id }}"
  class="widget widget-bento-grid {% if widget.settings.background_color != blank %}has-bg-color{% endif %}"
  {% if widget.settings.background_color != blank %}
    style="--widget-bg-color: {{ widget.settings.background_color }};"
  {% endif %}
  data-widget-id="{{ widget.id }}"
  data-widget-type="bento-grid"
>
  <style>
    #{{ widget.id }} {
      & .bento-grid-container {
        display: grid;
        grid-template-columns: repeat(1, 1fr);
        gap: {{ widget.settings.gap | default: 'var(--space-md)' }};
      }

      & .bento-item {
        position: relative;
        display: flex;
        flex-direction: column;
        padding: var(--space-xl);
        border-radius: var(--border-radius-lg);
        overflow: hidden;
        border: var(--border-width-thin) solid var(--border-color);
        text-decoration: none;
        transition: transform var(--transition-speed-normal), border-color var(--transition-speed-normal);
        min-height: 20rem;
        justify-content: flex-end;

        &.style-surface { background: var(--bg-secondary); }
        &.style-accent { background: var(--text-primary); color: var(--bg-primary); }
        &.style-dark { background: var(--text-primary); color: var(--bg-primary); }
        
        &.color-light { color: var(--bg-primary); }
        &.color-dark { color: var(--text-primary); }

        &.align-center { align-items: center; text-align: center; }
        &.align-start { align-items: flex-start; text-align: start; }

        &:hover {
          transform: translateY(-0.4rem);
          border-color: var(--border-color);
        }
      }

      & .bento-image-bg {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: 1;
      }

      & .bento-overlay {
        position: absolute;
        inset: 0;
        background: linear-gradient(to top, rgba(0,0,0,0.7) 0%, transparent 60%);
        z-index: 2;
      }

      & .bento-content {
        position: relative;
        z-index: 3;
        display: flex;
        flex-direction: column;
        gap: var(--space-xs);
        width: 100%;
      }

      & .bento-image-inline {
        width: 100%;
        height: 14rem;
        object-fit: contain;
        margin-block-end: var(--space-md);
      }

      @media (min-width: 990px) {
        & .bento-grid-container {
          grid-template-columns: repeat({{ widget.settings.columns_desktop | default: 4 }}, 1fr);
        }

        {% for blockId in widget.blocksOrder %}
          {% assign block = widget.blocks[blockId] %}
          & [data-block-id="{{ blockId }}"] {
            grid-column: span {{ block.settings.col_span | default: 1 | min: widget.settings.columns_desktop }};
            grid-row: span {{ block.settings.row_span | default: 1 }};
          }
        {% endfor %}
      }
    }
  </style>

  <div class="widget-container">
    {% if widget.settings.title != blank or widget.settings.description != blank or widget.settings.eyebrow != blank %}
      <div class="widget-header">
        {% if widget.settings.eyebrow != blank %}
          <span class="widget-eyebrow" data-setting="eyebrow">{{ widget.settings.eyebrow }}</span>
        {% endif %}
        {% if widget.settings.title != blank %}
          <h2 class="widget-headline" data-setting="title">{{ widget.settings.title }}</h2>
        {% endif %}
        {% if widget.settings.description != blank %}
          <p class="widget-description" data-setting="description">{{ widget.settings.description }}</p>
        {% endif %}
      </div>
    {% endif %}

    <div class="widget-content">
      <div class="bento-grid-container">
        {% for blockId in widget.blocksOrder %}
          {% assign block = widget.blocks[blockId] %}
          {% capture block_classes %}
            bento-item 
            style-{{ block.settings.bg_style | default: 'surface' }} 
            color-{{ block.settings.text_color | default: 'dark' }}
            align-{{ block.settings.alignment | default: 'start' }}
          {% endcapture %}

          <{% if block.settings.link.href != blank %}a href="{{ block.settings.link.href }}"{% else %}div{% endif %}
            class="{{ block_classes | strip_newlines | strip }}"
            data-block-id="{{ blockId }}"
          >
            {% if block.settings.bg_style == 'image-bg' and block.settings.image != blank %}
              {{ block.settings.image | image: 'large', 'bento-image-bg' }}
              <div class="bento-overlay"></div>
            {% elsif block.settings.image != blank %}
              {{ block.settings.image | image: 'medium', 'bento-image-inline' }}
            {% endif %}

            <div class="bento-content">
              {% if block.settings.title != blank %}
                <h3 class="widget-title" data-setting="title">{{ block.settings.title }}</h3>
              {% endif %}
              {% if block.settings.text != blank %}
                <p class="widget-text-small" data-setting="text">{{ block.settings.text }}</p>
              {% endif %}
            </div>
          </{% if block.settings.link.href != blank %}a{% else %}div{% endif %}>
        {% endfor %}
      </div>
    </div>
  </div>
</section>
