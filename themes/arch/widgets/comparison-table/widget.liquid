<section
  id="{{ widget.id }}"
  class="widget widget-comparison-table"
  data-widget-id="{{ widget.id }}"
  data-widget-type="comparison-table"
>
  <style>
    #{{ widget.id }} {
      & .comparison-table-wrapper {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        margin-inline: calc(var(--space-lg) * -1);
        padding-inline: var(--space-lg);
      }

      & .comparison-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        min-width: 60rem;
      }

      & .comparison-table-head {
        background-color: var(--bg-secondary);
      }

      & .comparison-table-th {
        padding: var(--space-lg) var(--space-md);
        text-align: center;
        font-size: var(--font-size-sm);
        font-weight: var(--font-weight-bold);
        color: var(--text-body);
        border-block-end: var(--border-width-medium) solid var(--border-light);
        vertical-align: top;

        &:first-child {
          text-align: start;
          padding-inline-start: var(--space-lg);
        }
      }

      & .comparison-table-th-featured {
        background-color: var(--text-primary);
        color: var(--bg-primary);
        position: relative;

        &::after {
          content: "";
          position: absolute;
          inset-inline-start: 0;
          inset-inline-end: 0;
          inset-block-end: -0.2rem;
          height: var(--border-width-medium);
          background-color: var(--border-darker);
        }
      }

      & .comparison-table-badge {
        display: block;
        font-size: var(--font-size-xs);
        font-weight: var(--font-weight-bold);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        background-color: var(--bg-primary);
        color: var(--text-primary);
        padding: 0.4rem 0.8rem;
        margin-block-start: var(--space-xs);
        width: fit-content;
        margin-inline: auto;
      }

      & .comparison-table-body {
        & tr:nth-child(even) {
          background-color: var(--bg-secondary);
        }
      }

      & .comparison-table-td {
        padding: var(--space-md) var(--space-md);
        text-align: center;
        border-block-end: var(--border-width-thin) solid var(--border-light);
        vertical-align: middle;

        &:first-child {
          text-align: start;
          font-weight: var(--font-weight-semibold);
          color: var(--text-body);
          padding-inline-start: var(--space-lg);
        }
      }

      & .comparison-table-td-featured {
        background-color: var(--bg-secondary);
      }

      & .comparison-table-check {
        color: var(--text-primary);
        font-size: 2.4rem;
        font-weight: var(--font-weight-bold);
        line-height: 1;
      }

      & .comparison-table-cross {
        color: var(--text-muted);
        font-size: 2.4rem;
        font-weight: var(--font-weight-bold);
        line-height: 1;
      }

      & .comparison-table-footer {
        text-align: center;
        margin-block-start: var(--space-2xl);
      }

      @media (min-width: 750px) {
        & .comparison-table-wrapper {
          margin-inline: 0;
          padding-inline: 0;
        }

        & .comparison-table {
          min-width: 0;
        }

        & .comparison-table-th {
          padding: var(--space-xl) var(--space-lg);
          font-size: var(--font-size-base);

          &:first-child {
            padding-inline-start: var(--space-xl);
          }
        }

        & .comparison-table-badge {
          font-size: var(--font-size-xs);
          padding: 0.6rem 1.2rem;
        }

        & .comparison-table-td {
          padding: var(--space-lg) var(--space-lg);

          &:first-child {
            padding-inline-start: var(--space-xl);
          }
        }

        & .comparison-table-check,
        & .comparison-table-cross {
          font-size: 2.8rem;
        }
      }

      @media (min-width: 990px) {
        & .comparison-table-th {
          font-size: var(--font-size-lg);
        }

        & .comparison-table-td {
          font-size: var(--font-size-base);
        }
      }
    }
  </style>

  {% comment %} Collect columns and features separately {% endcomment %}
  {% assign columns = '' %}
  {% assign features = '' %}
  {% for blockId in widget.blocksOrder %}
    {% assign block = widget.blocks[blockId] %}
    {% if block.type == 'column' %}
      {% if columns == '' %}
        {% assign columns = blockId %}
      {% else %}
        {% assign columns = columns | append: ',' | append: blockId %}
      {% endif %}
    {% elsif block.type == 'feature' %}
      {% if features == '' %}
        {% assign features = blockId %}
      {% else %}
        {% assign features = features | append: ',' | append: blockId %}
      {% endif %}
    {% endif %}
  {% endfor %}
  {% assign column_ids = columns | split: ',' %}
  {% assign feature_ids = features | split: ',' %}

  <div class="widget-container">
    {% if widget.settings.title != blank or widget.settings.description != blank or widget.settings.eyebrow != blank %}
      <div class="widget-header">
        {% if widget.settings.eyebrow != blank %}
          <span class="widget-eyebrow">{{ widget.settings.eyebrow }}</span>
        {% endif %}
        {% if widget.settings.title != blank %}
          <h2 class="widget-title">{{ widget.settings.title }}</h2>
        {% endif %}
        {% if widget.settings.description != blank %}
          <p class="widget-description">{{ widget.settings.description }}</p>
        {% endif %}
      </div>
    {% endif %}

    <div class="widget-content">
      <div class="comparison-table-wrapper">
        <table class="comparison-table">
          <thead class="comparison-table-head">
            <tr>
              <th class="comparison-table-th">{{ widget.settings.feature_column_label | default: 'Features' }}</th>
              {% for colId in column_ids %}
                {% assign col = widget.blocks[colId] %}
                <th class="comparison-table-th {% if col.settings.featured %}comparison-table-th-featured{% endif %}" data-block-id="{{ colId }}" {{ col.shopify_attributes }}>
                  <div>{{ col.settings.name }}</div>
                  {% if col.settings.badge != blank %}
                    <span class="comparison-table-badge">{{ col.settings.badge }}</span>
                  {% endif %}
                </th>
              {% endfor %}
            </tr>
          </thead>

          <tbody class="comparison-table-body">
            {% for featureId in feature_ids %}
              {% assign feature = widget.blocks[featureId] %}
              {% assign values = feature.settings.values | split: '
' %}
              <tr data-block-id="{{ featureId }}" {{ feature.shopify_attributes }}>
                <td class="comparison-table-td">{{ feature.settings.name }}</td>
                {% for colId in column_ids %}
                  {% assign col = widget.blocks[colId] %}
                  {% assign col_index = forloop.index0 %}
                  {% assign value = values[col_index] | strip %}
                  <td class="comparison-table-td {% if col.settings.featured %}comparison-table-td-featured{% endif %}">
                    {% if value == '✓' or value == 'yes' or value == 'Yes' or value == 'true' %}
                      <span class="comparison-table-check" aria-label="Included">✓</span>
                    {% elsif value == '✗' or value == 'no' or value == 'No' or value == 'false' or value == 'x' or value == 'X' %}
                      <span class="comparison-table-cross" aria-label="Not included">✗</span>
                    {% elsif value != blank %}
                      {{ value }}
                    {% else %}
                      <span class="comparison-table-cross" aria-label="Not included">✗</span>
                    {% endif %}
                  </td>
                {% endfor %}
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      {% if widget.settings.cta_link.text != blank %}
        <div class="comparison-table-footer">
          <a href="{{ widget.settings.cta_link.href }}" class="widget-button widget-button-primary" {% if widget.settings.cta_link.target == '_blank' %}target="_blank" rel="noopener"{% endif %}>
            {{ widget.settings.cta_link.text }}
          </a>
        </div>
      {% endif %}
    </div>
  </div>
</section>
