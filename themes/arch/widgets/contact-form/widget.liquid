<section
  id="{{ widget.id }}"
  class="widget widget-contact {% if widget.settings.sidebar_position == 'left' %}layout-reverse{% endif %}"
  data-widget-id="{{ widget.id }}"
  data-widget-type="contact-form"
>
  <style>
    #{{ widget.id }} {
      & .contact-content {
        display: grid;
        grid-template-columns: 1fr;
        gap: var(--space-lg);
      }

      & .contact-form {
        display: flex;
        flex-direction: column;
        gap: var(--space-lg);
      }

      & .form-group {
        display: flex;
        flex-direction: column;
        gap: var(--space-xs);
      }

      & .form-label {
        font-size: var(--font-size-sm);
        color: var(--text-content);
      }

      & .form-input,
      & .form-textarea,
      & .form-select {
        padding: var(--space-sm) var(--space-md);
        font-size: var(--font-size-base);
        font-family: inherit;
        border: var(--border-width-thin) solid var(--border-color);
        background-color: var(--bg-primary);
        color: var(--text-content);
        transition: border-color 0.3s;

        &:focus {
          outline: none;
          border-color: var(--border-color);
        }

        &::placeholder {
          color: var(--text-muted);
        }
      }

      & .form-textarea {
        resize: vertical;
        min-height: 15rem;
      }

      & .form-select {
        cursor: pointer;
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right var(--space-md) center;
        padding-inline-end: var(--space-2xl);
      }

      & .form-checkbox-group {
        display: flex;
        align-items: flex-start;
        gap: var(--space-sm);
      }

      & .form-checkbox {
        width: 2rem;
        height: 2rem;
        margin: 0;
        cursor: pointer;
        accent-color: var(--text-heading);
        flex-shrink: 0;
      }

      & .form-checkbox-label {
        font-size: var(--font-size-base);
        color: var(--text-content);
        cursor: pointer;
        line-height: var(--line-height-normal);
      }

      /* Contact Info Sidebar */
      & .contact-info {
        display: flex;
        flex-direction: column;
        gap: var(--space-xl);
      }

      & .contact-info-block {
        display: flex;
        flex-direction: column;
        gap: var(--space-sm);
      }

      & .contact-info-title {
        font-size: var(--font-size-lg);
        color: var(--text-heading);
        margin: 0;
      }

      & .contact-info-text {
        font-size: var(--font-size-base);
        line-height: var(--line-height-relaxed);
        color: var(--text-muted);
        margin: 0;
      }

      & .contact-info-link {
        color: var(--text-heading);
        text-decoration: none;
        transition: color 0.3s;

        &:hover {
          color: var(--text-muted);
          text-decoration: underline;
        }
      }

      @media (min-width: 750px) {
        & .contact-content:not(.no-sidebar) {
          grid-template-columns: 7fr 3fr;
          gap: var(--space-3xl);
        }
      }

      /* Variant: Reverse Layout (sidebar left) */
      &.layout-reverse {
        @media (min-width: 750px) {
          & .contact-content:not(.no-sidebar) {
            grid-template-columns: 3fr 7fr;
          }

          & .contact-form {
            order: 2;
          }

          & .contact-info {
            order: 1;
          }
        }
      }
    }
  </style>

  <div class="widget-container">
    {% if widget.settings.title != blank or widget.settings.description != blank or widget.settings.eyebrow != blank %}
      <div class="widget-header">
        {% if widget.settings.eyebrow != blank %}
          <span class="widget-eyebrow" data-setting="eyebrow">{{ widget.settings.eyebrow }}</span>
        {% endif %}
        {% if widget.settings.title != blank %}
          <h2 class="widget-headline" data-setting="title">{{ widget.settings.title }}</h2>
        {% endif %}
        {% if widget.settings.description != blank %}
          <p class="widget-description" data-setting="description">{{ widget.settings.description }}</p>
        {% endif %}
      </div>
    {% endif %}

    <div class="widget-content {% unless widget.settings.show_sidebar %}widget-content-sm{% endunless %}">
      <div class="contact-content {% unless widget.settings.show_sidebar %}no-sidebar{% endunless %}">
        <!-- Contact Form -->
        <form
          class="contact-form"
          action="{{ widget.settings.form_action }}"
          method="{{ widget.settings.form_method }}"
        >
          {% for blockId in widget.blocksOrder %}
            {% assign block = widget.blocks[blockId] %}
            {% if block.type != 'info' %}
              {% assign field_id = widget.id | append: '-' | append: block.settings.name %}

              {% case block.type %}
                {% when 'input' %}
                  <div class="form-group" data-block-id="{{ blockId }}">
                    <label for="{{ field_id }}" class="form-label">
                      {{ block.settings.label -}}
                      {%- if block.settings.required %} *{% endif %}
                    </label>
                    <input
                      type="{{ block.settings.input_type }}"
                      id="{{ field_id }}"
                      name="{{ block.settings.name }}"
                      class="form-input"
                      {% if block.settings.placeholder != blank %}
                        placeholder="{{ block.settings.placeholder }}"
                      {% endif %}
                      {% if block.settings.required %}
                        required aria-required="true"
                      {% endif %}
                    >
                  </div>

                {% when 'textarea' %}
                  <div class="form-group" data-block-id="{{ blockId }}">
                    <label for="{{ field_id }}" class="form-label">
                      {{ block.settings.label -}}
                      {%- if block.settings.required %} *{% endif %}
                    </label>
                    <textarea
                      id="{{ field_id }}"
                      name="{{ block.settings.name }}"
                      class="form-textarea"
                      {% if block.settings.placeholder != blank %}
                        placeholder="{{ block.settings.placeholder }}"
                      {% endif %}
                      {% if block.settings.required %}
                        required aria-required="true"
                      {% endif %}
                    ></textarea>
                  </div>

                {% when 'dropdown' %}
                  <div class="form-group" data-block-id="{{ blockId }}">
                    <label for="{{ field_id }}" class="form-label">
                      {{ block.settings.label -}}
                      {%- if block.settings.required %} *{% endif %}
                    </label>
                    <select
                      id="{{ field_id }}"
                      name="{{ block.settings.name }}"
                      class="form-select"
                      {% if block.settings.required %}
                        required aria-required="true"
                      {% endif %}
                    >
                      <option value="">Select an option</option>
                      {% assign options = block.settings.options | split: '
' %}
                      {% for option in options %}
                        {% assign trimmed_option = option | strip %}
                        {% if trimmed_option != blank %}
                          <option value="{{ trimmed_option | handleize }}">{{ trimmed_option }}</option>
                        {% endif %}
                      {% endfor %}
                    </select>
                  </div>

                {% when 'checkbox' %}
                  <div class="form-group" data-block-id="{{ blockId }}">
                    <div class="form-checkbox-group">
                      <input
                        type="checkbox"
                        id="{{ field_id }}"
                        name="{{ block.settings.name }}"
                        class="form-checkbox"
                        {% if block.settings.required %}
                          required aria-required="true"
                        {% endif %}
                      >
                      <label for="{{ field_id }}" class="form-checkbox-label">
                        {{ block.settings.label -}}
                        {%- if block.settings.required %} *{% endif %}
                      </label>
                    </div>
                  </div>

                {% when 'submit' %}
                  <div class="form-group" data-block-id="{{ blockId }}">
                    <button type="submit" class="widget-button widget-button-primary">
                      {{ block.settings.text }}
                    </button>
                  </div>
              {% endcase %}
            {% endif %}
          {% endfor %}
        </form>

        {% if widget.settings.show_sidebar %}
          <!-- Contact Information Sidebar -->
          <div class="contact-info">
            {% for blockId in widget.blocksOrder %}
              {% assign block = widget.blocks[blockId] %}
              {% if block.type == 'info' %}
                <div class="contact-info-block" data-block-id="{{ blockId }}">
                  {% if block.settings.title != blank %}
                    <h3 class="contact-info-title" data-setting="title">{{ block.settings.title }}</h3>
                  {% endif %}
                  {% if block.settings.text != blank %}
                    <p class="contact-info-text">
                      {% if block.settings.link.href != blank %}
                        <a
                          href="{{ block.settings.link.href }}"
                          class="contact-info-link"
                          data-setting="text"
                          {% if block.settings.link.target == '_blank' %}
                            target="_blank" rel="noopener"
                          {% endif %}
                        >
                          {{ block.settings.text }}
                        </a>
                      {% else %}
                        <span data-setting="text">{{ block.settings.text }}</span>
                      {% endif %}
                    </p>
                  {% endif %}
                </div>
              {% endif %}
            {% endfor %}
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</section>
