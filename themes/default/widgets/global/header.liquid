<header
    class="site-header"
    data-widget-id="{{ widget.id }}"
    data-widget-type="header"
>
    <style>
        #{{ widget.id }}.site-header__container {
            padding: {{ widget.settings.headerPadding }}px;
            background-color: {{ widget.settings.headerBackgroundColor }};
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            gap: 2rem;
        }

        #{{ widget.id }} .site-header__menu-left {
            justify-self: start;
        }

        #{{ widget.id }} .site-header__branding {
            justify-self: center;
            text-align: center;
        }

        #{{ widget.id }} .site-header__menu-right {
            justify-self: end;
        }

        #{{ widget.id }} .site-header__title {
            margin: 0;
            font-size: {{ widget.settings.headerTitleSize }}px;
            color: {{ widget.settings.headerTitleColor }};
        }

        #{{ widget.id }} .site-header__tagline {
            color: {{ widget.settings.headerTaglineColor }};
            margin-top: 0.5rem;
            font-size: 0.9em;
        }

        /* Desktop Menu styles */
        #{{ widget.id }} .site-header__nav-list {
            display: flex;
            list-style: none;
            margin: 0;
            padding: 0;
        }

        #{{ widget.id }} .site-header__menu-left .site-header__nav-item {
            margin-right: 1.5rem;
        }

        #{{ widget.id }} .site-header__menu-right .site-header__nav-item {
            margin-left: 1.5rem;
        }

        #{{ widget.id }} .site-header__nav-item {
            position: relative;
        }

        #{{ widget.id }} .site-header__nav-item::after {
            content: "";
            position: absolute;
            height: 20px;
            width: 100%;
            bottom: -20px;
            left: 0;
        }

        #{{ widget.id }} .site-header__nav-link {
            color: {{ widget.settings.headerTitleColor }};
            text-decoration: none;
            padding: 0.5rem 0;
            display: block;
            transition: color 0.2s ease;
        }

        #{{ widget.id }} .site-header__nav-link:hover {
            color: #0066cc;
        }

        #{{ widget.id }} .site-header__nav-item--has-submenu > .site-header__nav-link::after {
            content: "⌵";
            display: inline-block;
            margin-left: 0.4em;
            font-size: 0.8em;
            position: relative;
            top: -1px;
            transition: transform 0.2s ease;
        }

        #{{ widget.id }} .site-header__nav-item--has-submenu:hover > .site-header__nav-link::after {
            transform: rotate(180deg);
        }

        #{{ widget.id }} .site-header__nav-submenu {
            display: none;
            position: absolute;
            right: 0;
            top: calc(100% + 10px);
            background: white;
            min-width: 180px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-radius: 6px;
            list-style: none;
            padding: 8px 0;
            z-index: 100;
            opacity: 0;
            transform: translateY(-5px);
            transition: opacity 0.2s, transform 0.2s;
        }

        #{{ widget.id }} .site-header__nav-submenu::before {
            content: "";
            position: absolute;
            top: -6px;
            right: 20px;
            width: 12px;
            height: 12px;
            background: white;
            transform: rotate(45deg);
            box-shadow: -2px -2px 5px rgba(0,0,0,0.05);
        }

        #{{ widget.id }} .site-header__nav-item:hover > .site-header__nav-submenu {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        #{{ widget.id }} .site-header__nav-submenu .site-header__nav-link {
            padding: 8px 16px;
            color: #333;
        }

        #{{ widget.id }} .site-header__nav-submenu .site-header__nav-link:hover {
            background: #f7f9fc;
        }

        /* Mobile menu toggle */
        #{{ widget.id }} .site-header__mobile-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: {{ widget.settings.headerTitleColor }};
            cursor: pointer;
            padding: 0.5rem;
        }

        #{{ widget.id }} .site-header__mobile-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: {{ widget.settings.headerBackgroundColor }};
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        #{{ widget.id }} .site-header__mobile-menu.active {
            display: block;
        }

        #{{ widget.id }} .site-header__mobile-nav {
            list-style: none;
            margin: 0;
            padding: 1rem 0;
        }

        #{{ widget.id }} .site-header__mobile-nav .site-header__nav-link,
        #{{ widget.id }} .site-header__mobile-nav .site-header__mobile-nav-link {
            padding: 0.75rem {{ widget.settings.headerPadding }}px;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        #{{ widget.id }} .site-header__mobile-nav-item {
            display: block;
        }

        #{{ widget.id }} .site-header__mobile-nav-item .site-header__nav-submenu {
            display: none;
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            #{{ widget.id }}.site-header__container {
                grid-template-columns: auto 1fr auto;
                gap: 1rem;
                position: relative;
            }

            #{{ widget.id }} .site-header__menu-left,
            #{{ widget.id }} .site-header__menu-right {
                display: none;
            }

            #{{ widget.id }} .site-header__mobile-toggle {
                display: block;
                grid-column: 1;
            }

            #{{ widget.id }} .site-header__branding {
                grid-column: 2;
            }

            #{{ widget.id }} .site-header__title {
                font-size: {{ widget.settings.headerTitleSize | times: 0.8 }}px;
            }

            #{{ widget.id }} .site-header__tagline {
                font-size: 0.8em;
            }
        }
    </style>

    <div id="{{ widget.id }}" class="site-header__container">
        <!-- Mobile menu toggle -->
        <button class="site-header__mobile-toggle" onclick="toggleMobileMenu('{{ widget.id }}')">
            <span id="menu-icon-{{ widget.id }}">☰</span>
        </button>

        <!-- Left Menu -->
        {% if widget.settings.headerNavigationLeft %}
            <div class="site-header__menu-left">
                {% render 'menu',
                    menu: widget.settings.headerNavigationLeft,
                    class_menu: 'site-header__nav',
                    class_list: 'site-header__nav-list',
                    class_item: 'site-header__nav-item',
                    class_link: 'site-header__nav-link',
                    class_submenu: 'site-header__nav-submenu',
                    class_has_submenu: 'site-header__nav-item--has-submenu'
                %}
            </div>
        {% endif %}

        <!-- Branding (Center) -->
        <div class="site-header__branding">
            <h1 class="site-header__title">
                {{ widget.settings.headerTitle }}
            </h1>
            {% if widget.settings.headerTagline and widget.settings.headerTagline != '' %}
                <div class="site-header__tagline">
                    {{ widget.settings.headerTagline }}
                </div>
            {% endif %}
        </div>

        <!-- Right Menu -->
        {% if widget.settings.headerNavigationRight %}
            <div class="site-header__menu-right">
                {% render 'menu',
                    menu: widget.settings.headerNavigationRight,
                    class_menu: 'site-header__nav',
                    class_list: 'site-header__nav-list',
                    class_item: 'site-header__nav-item',
                    class_link: 'site-header__nav-link',
                    class_submenu: 'site-header__nav-submenu',
                    class_has_submenu: 'site-header__nav-item--has-submenu'
                %}
            </div>
        {% endif %}

        <!-- Mobile menu (populated by JavaScript) -->
        <div class="site-header__mobile-menu" id="mobile-menu-{{ widget.id }}">
            <ul class="site-header__mobile-nav" id="mobile-nav-{{ widget.id }}">
                <!-- Menu items will be dynamically inserted here by JavaScript -->
            </ul>
        </div>
    </div>

        <script>
        function initializeHeader(widgetId) {
            populateMobileMenu(widgetId);
        }

        function populateMobileMenu(widgetId) {
            const mobileNav = document.getElementById('mobile-nav-' + widgetId);
            const leftMenu = document.querySelector(`[data-widget-id="${widgetId}"] .site-header__menu-left .site-header__nav-list`);
            const rightMenu = document.querySelector(`[data-widget-id="${widgetId}"] .site-header__menu-right .site-header__nav-list`);

            if (!mobileNav) return;

            // Clear existing mobile menu items
            mobileNav.innerHTML = '';

            // Add left menu items first
            if (leftMenu) {
                const leftItems = leftMenu.querySelectorAll('.site-header__nav-item');
                leftItems.forEach(function(item) {
                    const clonedItem = item.cloneNode(true);
                    // Remove desktop-specific classes and add mobile classes
                    clonedItem.classList.remove('site-header__nav-item');
                    clonedItem.classList.add('site-header__mobile-nav-item');

                    // Update link classes for mobile
                    const link = clonedItem.querySelector('.site-header__nav-link');
                    if (link) {
                        link.classList.add('site-header__mobile-nav-link');
                    }

                    mobileNav.appendChild(clonedItem);
                });
            }

            // Add right menu items after left items
            if (rightMenu) {
                const rightItems = rightMenu.querySelectorAll('.site-header__nav-item');
                rightItems.forEach(function(item) {
                    const clonedItem = item.cloneNode(true);
                    // Remove desktop-specific classes and add mobile classes
                    clonedItem.classList.remove('site-header__nav-item');
                    clonedItem.classList.add('site-header__mobile-nav-item');

                    // Update link classes for mobile
                    const link = clonedItem.querySelector('.site-header__nav-link');
                    if (link) {
                        link.classList.add('site-header__mobile-nav-link');
                    }

                    mobileNav.appendChild(clonedItem);
                });
            }
        }

        function toggleMobileMenu(widgetId) {
            const mobileMenu = document.getElementById('mobile-menu-' + widgetId);
            const menuIcon = document.getElementById('menu-icon-' + widgetId);

            if (mobileMenu.classList.contains('active')) {
                mobileMenu.classList.remove('active');
                menuIcon.textContent = '☰';
            } else {
                mobileMenu.classList.add('active');
                menuIcon.textContent = '✕';
            }
        }

        // Initialize header when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            const headers = document.querySelectorAll('.site-header');
            headers.forEach(function(header) {
                const widgetId = header.getAttribute('data-widget-id');
                initializeHeader(widgetId);
            });
        });

        // Close mobile menu when clicking outside
        document.addEventListener('click', function(event) {
            const headers = document.querySelectorAll('.site-header');
            headers.forEach(function(header) {
                const widgetId = header.getAttribute('data-widget-id');
                const mobileMenu = document.getElementById('mobile-menu-' + widgetId);

                if (mobileMenu && mobileMenu.classList.contains('active') &&
                    !header.contains(event.target)) {
                    mobileMenu.classList.remove('active');
                    const menuIcon = document.getElementById('menu-icon-' + widgetId);
                    if (menuIcon) menuIcon.textContent = '☰';
                }
            });
        });
    </script>

    <script type="application/json" data-widget-schema>
        {
            "type": "header",
            "displayName": "Site Header",
            "settings": [
                {
                    "type": "text",
                    "id": "headerTitle",
                    "label": "Site Title",
                    "description": "Main site title",
                    "default": "Aegean"
                },
                {
                    "type": "text",
                    "id": "headerTagline",
                    "label": "Tagline",
                    "description": "Site tagline or description",
                    "default": "Boutique Villas in Santorini"
                },
                {
                    "type": "menu",
                    "id": "headerNavigationLeft",
                    "label": "Left Navigation Menu",
                    "description": "Select the menu to display on the left side",
                    "default": ""
                },
                {
                    "type": "menu",
                    "id": "headerNavigationRight",
                    "label": "Right Navigation Menu",
                    "description": "Select the menu to display on the right side",
                    "default": ""
                },
                {
                    "type": "color",
                    "id": "headerBackgroundColor",
                    "label": "Background Color",
                    "description": "Header background color",
                    "default": "#f8f9fa"
                },
                {
                    "type": "color",
                    "id": "headerTitleColor",
                    "label": "Title Color",
                    "description": "Color of the site title",
                    "default": "#333333"
                },
                {
                    "type": "color",
                    "id": "headerTaglineColor",
                    "label": "Tagline Color",
                    "description": "Color of the tagline text",
                    "default": "#666666"
                },
                {
                    "type": "range",
                    "id": "headerTitleSize",
                    "label": "Title Size",
                    "description": "Size of the title in pixels",
                    "default": 32,
                    "min": 16,
                    "max": 72,
                    "step": 1
                },
                {
                    "type": "range",
                    "id": "headerPadding",
                    "label": "Padding",
                    "description": "Padding around the header content",
                    "default": 32,
                    "min": 0,
                    "max": 100,
                    "step": 4
                }
            ]
        }
    </script>
</header>